language: php

sudo: false

services:
  - docker

php:
  - 7.3

# Build is failing in moment:
# https://docs.travis-ci.com/user/for-beginners/#breaking-the-build

# Travis and docker https://docs.travis-ci.com/user/docker/
# PHP in Travis https://docs.travis-ci.com/user/languages/php/

before_script:
  - mkdir -p ./var/cache ./build/logs
  - mkdir ./var/cache/test ./var/cache/dev ./var/cache/prod
  - chmod 777 -R ./var
  - cp .env.dist .env
  - cp phpunit.xml.dist phpunit.xml
  - composer install
  - docker-compose up -d

script:
  - docker container exec travis_app php ./vendor/bin/phpunit

after_success:
  - travis_retry docker container exec -e TRAVIS=$TRAVIS TRAVIS_JOB_ID=$TRAVIS_JOB_ID TRAVIS_BRANCH=$TRAVIS_BRANCH
      TRAVIS_PULL_REQUEST=$TRAVIS_PULL_REQUEST travis_app php vendor/bin/php-coveralls -v